# Create a ready-to-deploy folder with signup/login, payments, download, and a placeholder extension ZIP.
# We'll package it as goblinreach-site.zip for the user to download.
import os, zipfile, textwrap, json, io, pathlib

base = "/mnt/data/goblinreach-site"
public = os.path.join(base, "public")
os.makedirs(public, exist_ok=True)

# vercel.json to ensure / serves index.html
vercel_json = {
    "rewrites": [
        {"source": "/", "destination": "/index.html"}
    ]
}
with open(os.path.join(base, "vercel.json"), "w") as f:
    json.dump(vercel_json, f, indent=2)

# index.html with client-side Supabase auth (works once user pastes their keys)
index_html = textwrap.dedent("""\
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GoblinReach — DM Automation</title>
  <meta name="description" content="Compliant, human-like Instagram DM automation with 24/7 cloud, proxies, and VPN-friendly setup." />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{ --bg:#070a08; --panel:#0c1210; --ink:#e9ffe8; --muted:#9fd6a6; --brand:#22c55e; --line:#15211a; --glow:rgba(34,197,94,.22); }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:radial-gradient(1200px 800px at 70% -10%,#112218 0%,transparent 60%),linear-gradient(180deg,#0a0f0c,#060807 60%);color:var(--ink)}
    a{color:var(--brand);text-decoration:none}
    .wrap{max-width:1200px;margin-inline:auto;padding:28px}
    header{display:flex;align-items:center;gap:16px;justify-content:space-between;margin-bottom:18px}
    .badge{font-size:12px;padding:6px 10px;border-radius:999px;border:1px solid var(--line);background:#0b150f;color:var(--muted);display:inline-flex;gap:8px;align-items:center}
    .badge .dot{width:8px;height:8px;border-radius:50%;background:var(--brand);box-shadow:0 0 0 3px var(--glow)}
    .logo{display:flex;align-items:center;gap:10px;font-weight:800}
    .mark{width:28px;height:28px;border-radius:10px;background:conic-gradient(from 210deg at 50% 50%,#183325,#31f189 40%,#0b1a13 60%);box-shadow:0 0 0 1px #163b2a,0 10px 25px rgba(18,241,137,.12)}
    nav{display:flex;align-items:center;gap:12px}
    .btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:12px 16px;border-radius:14px;border:1px solid #1c2a22;background:#0c140f;color:var(--ink);font-weight:600;cursor:pointer}
    .btn.primary{background:linear-gradient(180deg,#20d66a,#129a49);border-color:#118844;color:#021307;box-shadow:0 10px 24px rgba(34,197,94,.25)}
    .grid{display:grid;grid-template-columns:1.2fr .95fr;gap:20px}
    .card{background:linear-gradient(180deg,#0d1511,#0b120f);border:1px solid var(--line);border-radius:20px;padding:22px;box-shadow:0 20px 60px rgba(0,0,0,.35)}
    .h1{font-size:44px;line-height:1.1;margin:10px 0 12px}
    .lede{color:var(--muted);max-width:720px}
    .ctaRow{display:flex;gap:12px;margin:18px 0 10px}
    .kpis{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:12px;margin-top:14px}
    .k{background:#0e1612;border:1px solid var(--line);padding:16px;border-radius:16px}
    .k .v{font-size:28px;font-weight:800}
    .panel{background:linear-gradient(180deg,#0e1713,#0b1310);border:1px solid var(--line);border-radius:18px;padding:18px}
    .label{font-size:12px;color:var(--muted)}
    .row{display:flex;gap:10px;align-items:center}
    .stack{display:flex;flex-direction:column;gap:10px}
    .input, select, textarea{width:100%;padding:12px 12px;border-radius:12px;border:1px solid #1f2a24;background:#0b100e;color:var(--ink)}
    .toggle{--s:22px;width:48px;height:26px;border-radius:999px;background:#0f1a14;border:1px solid #193325;position:relative;box-shadow:inset 0 0 0 2px rgba(0,0,0,.2)}
    .toggle::after{content:"";position:absolute;top:50%;left:3px;transform:translateY(-50%);width:22px;height:22px;border-radius:50%;background:#1b2a22;transition:.2s}
    .toggle.on{background:#1ccf67}
    .toggle.on::after{left:23px;background:#06240f}
    .statusLight{width:10px;height:10px;border-radius:50%;background:#ff4d4d;box-shadow:0 0 0 3px rgba(239,68,68,.18)}
    footer{padding:28px 0;color:#94caa1}
    @media (max-width:1050px){.grid{grid-template-columns:1fr}.h1{font-size:36px}}
    .note{background:#0c140f;border:1px dashed #1f2a24;border-radius:12px;padding:10px;color:#a9e0b1;margin-top:8px}
  </style>

  <!-- Paste your Supabase keys here (client-side anon is safe to expose) -->
  <meta name="supabase-url" content="">
  <meta name="supabase-anon" content="">

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="row">
        <div class="logo"><div class="mark"></div>GoblinReach <span class="label" style="margin-left:6px">DM Automation for Client Apps</span></div>
        <span class="badge"><span class="dot"></span>24/7 Cloud • Proxies • VPN Ready</span>
      </div>
      <nav>
        <a class="btn" href="https://instagram.com/goblinreach.ai" target="_blank" rel="noopener">Instagram</a>
        <button class="btn" id="openAuth">Login / Sign Up</button>
      </nav>
    </header>

    <main class="grid">
      <!-- LEFT HERO -->
      <section class="card">
        <h1 class="h1">Get High‑Ticket Clients<br/>on Autopilot.</h1>
        <p class="lede">GoblinReach looks like a $1,000/mo tool, but it’s built to own your market. Compliant, human‑like DM automation.</p>
        <div class="ctaRow">
          <a class="btn" id="downloadBtn" href="/goblinreach-extension.zip" download>Download Extension</a>
        </div>
        <div class="kpis">
          <div class="k"><div class="label">Avg. Replies / 100 DMs</div><div class="v">18–31</div></div>
          <div class="k"><div class="label">Active Users</div><div class="v">1,000+</div></div>
          <div class="k"><div class="label">Compliance</div><div class="v">Rate‑limits<br/>• Randomizer</div></div>
        </div>
      </section>

      <!-- RIGHT PREVIEW -->
      <section class="card">
        <div class="row" style="justify-content:space-between;margin-bottom:10px">
          <div class="label"><strong>LIVE Preview:</strong> Stable features only. Keep ~<strong>600s</strong> between actions across accounts for best deliverability.</div>
          <div class="row" style="gap:12px"><div class="label">Automation</div><div class="toggle" id="autoTgl" aria-label="automation toggle" role="switch" aria-checked="false"></div><div class="label">Status</div><div class="statusLight" id="statusDot"></div></div>
        </div>
        <div class="row" style="gap:16px">
          <div class="stack" style="flex:1">
            <label class="label">Target</label>
            <select class="input" id="targetSel">
              <option>Followers of target account</option>
              <option>People they are following</option>
              <option>People who liked a post</option>
              <option>People who commented on a post</option>
            </select>
          </div>
          <div class="stack" style="width:180px">
            <label class="label">Delay (sec)</label>
            <input class="input" id="delay" type="number" min="300" value="600" />
          </div>
        </div>
        <div class="stack" style="margin-top:10px">
          <label class="label">Message Template (custom)</label>
          <textarea class="input" id="msg" rows="4" placeholder="Hey {{name}} — quick one…"></textarea>
        </div>

        <div class="panel note" id="authNote" style="display:none"></div>
      </section>
    </main>

    <!-- AUTH CARD -->
    <section class="card" id="authCard" style="margin-top:20px; display:none">
      <div class="label">Create Account</div>
      <input class="input" id="signupUsername" placeholder="Username" />
      <input class="input" id="signupEmail" placeholder="Email" type="email" />
      <input class="input" id="signupPassword" placeholder="Password" type="password" />
      <button class="btn primary" id="signupBtn">Sign Up</button>
      <div class="label" style="margin-top:12px">Login</div>
      <input class="input" id="loginIdentifier" placeholder="Email or Username" />
      <input class="input" id="loginPassword" placeholder="Password" type="password" />
      <button class="btn" id="loginBtn">Login</button>
    </section>

    <!-- PAYMENTS -->
    <section class="card" style="margin-top:20px">
      <div class="label">Payments</div>
      <p class="label">Choose your payment method below. After payment, accounts will be manually activated if not instant.</p>
      <a class="btn primary" href="https://buy.stripe.com/cNi14mbtHajR98jdBuaZi03" target="_blank" rel="noopener">Pay with Card (Stripe)</a>
      <a class="btn" href="https://cash.app/$triple4mgmt" target="_blank" rel="noopener">Pay via Cash App — $triple4mgmt</a>
    </section>

    <footer>
      <div class="row" style="justify-content:space-between">
        <div>© 2025 GoblinReach. Compliant automation with human‑like pacing.</div>
        <div class="row" style="gap:8px">
          <a href="mailto:support@goblinreach.live">Support</a>
          <a href="https://instagram.com/goblinreach.ai" target="_blank" rel="noopener">Instagram</a>
        </div>
      </div>
    </footer>
  </div>

  <script>
    const $ = (s)=>document.querySelector(s);
    const tgl = $('#autoTgl');
    const dot = $('#statusDot');
    tgl && tgl.addEventListener('click',()=>{
      const on = tgl.classList.toggle('on');
      tgl.setAttribute('aria-checked', on? 'true':'false');
      dot.style.background = on ? '#10b981' : '#ff4d4d';
      dot.style.boxShadow = on ? '0 0 0 3px rgba(16,185,129,.18)' : '0 0 0 3px rgba(239,68,68,.18)';
    });

    // Auth (client-side Supabase)
    const SUPABASE_URL = document.querySelector('meta[name=\"supabase-url\"]').content.trim();
    const SUPABASE_ANON = document.querySelector('meta[name=\"supabase-anon\"]').content.trim();
    let supa = null;

    function showAuthNote(msg){ const n = $('#authNote'); if(n){ n.style.display='block'; n.textContent = msg; } }
    function toggleAuthCard(show){ $('#authCard').style.display = show ? 'block' : 'none'; }

    document.getElementById('openAuth').addEventListener('click', ()=> toggleAuthCard(true));

    document.addEventListener('DOMContentLoaded', async() => {
      // Check ZIP
      fetch('/goblinreach-extension.zip',{method:'HEAD'})
        .then(r=>{ if(!r.ok) throw new Error('missing'); })
        .catch(()=>{
          const btn=$('#downloadBtn');
          if(btn){btn.insertAdjacentHTML('afterend','<p class=\"label\">Upload <code>public/goblinreach-extension.zip</code> to enable this download.</p>');}
        });

      // Setup Supabase (optional until keys are added)
      if (!SUPABASE_URL || !SUPABASE_ANON) {
        showAuthNote('Add your Supabase URL and Anon Key at the top of index.html to enable real signup/login.');
        return;
      }
      supa = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON);
      const { data: { session } } = await supa.auth.getSession();
      if (session) showAuthNote('Logged in as ' + (session.user.email || session.user.id));
    });

    async function signUp(){ 
      if (!supa) return showAuthNote('Supabase not configured yet.');
      const email = $('#signupEmail').value.trim();
      const password = $('#signupPassword').value;
      const username = $('#signupUsername').value.trim();
      if(!email || !password || !username) return showAuthNote('Fill all fields.');
      const { data, error } = await supa.auth.signUp({ email, password, options: { data: { username } } });
      if(error) return showAuthNote('Signup failed: ' + error.message);
      showAuthNote('Account created. Check your email to verify (if required).');
    }

    async function login(){ 
      if (!supa) return showAuthNote('Supabase not configured yet.');
      const id = $('#loginIdentifier').value.trim();
      const pass = $('#loginPassword').value;
      if(!id || !pass) return showAuthNote('Enter email/username and password.');
      // If a non-email is given, we try email anyway (Supabase supports email only here).
      const { data, error } = await supa.auth.signInWithPassword({ email: id, password: pass });
      if(error) return showAuthNote('Login failed: ' + error.message);
      showAuthNote('Logged in.');
      toggleAuthCard(false);
    }

    $('#signupBtn').addEventListener('click', signUp);
    $('#loginBtn').addEventListener('click', login);
  </script>
</body>
</html>
""")
with open(os.path.join(base, "index.html"), "w", encoding="utf-8") as f:
    f.write(index_html)

# Create a tiny valid ZIP placeholder for the extension
placeholder_zip_path = os.path.join(public, "goblinreach-extension.zip")
with zipfile.ZipFile(placeholder_zip_path, 'w', zipfile.ZIP_DEFLATED) as z:
    z.writestr("README.txt", "Replace this ZIP with your real Chrome extension files.\nIt is only a placeholder so the Download button works.")

# Now zip the whole folder for the user
zip_out = "/mnt/data/goblinreach-site.zip"
with zipfile.ZipFile(zip_out, 'w', zipfile.ZIP_DEFLATED) as z:
    for root, dirs, files in os.walk(base):
        for name in files:
            path = os.path.join(root, name)
            arcname = os.path.relpath(path, base)
            z.write(path, arcname)

zip_out

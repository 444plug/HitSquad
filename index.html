<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GoblinReach — DM Automation (One‑File Edition)</title>
  <meta name="description" content="Let AI handle your Instagram DMs — safely, on autopilot. One‑paste landing + instant download." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
  <style>
    :root { --g: #22c55e; --g2: #16a34a; --bg: #060606; }
    html, body { background:#000; color:#e5e7eb; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin:0; overflow-x: hidden; }
    .max-w-6xl { max-width: 72rem; margin-left: auto; margin-right: auto; }
    .px-4 { padding-left: 1rem; padding-right: 1rem; }
    .py-3 { padding-top: 0.75rem; padding-bottom: 0.75rem; }
    .py-16 { padding-top: 4rem; padding-bottom: 4rem; }
    .mt-4 { margin-top: 1rem; }
    .mt-6 { margin-top: 1.5rem; }
    .mt-2 { margin-top: 0.5rem; }
    .mt-8 { margin-top: 2rem; }
    .mb-16 { margin-bottom: 4rem; }
    .gap-3 { gap: 0.75rem; }
    .gap-2 { gap: 0.5rem; }
    .gap-4 { gap: 1rem; }
    .flex { display: flex; }
    .flex-wrap { flex-wrap: wrap; }
    .items-center { align-items: center; }
    .justify-between { justify-content: space-between; }
    .grid { display: grid; }
    .md\:grid-cols-2 { grid-template-columns: repeat(1, minmax(0, 1fr)); }
    @media (min-width: 768px) { .md\:grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); } }
    .md\:grid-cols-3 { grid-template-columns: repeat(1, minmax(0, 1fr)); }
    @media (min-width: 768px) { .md\:grid-cols-3 { grid-template-columns: repeat(3, minmax(0, 1fr)); } }
    .md\:flex-row { flex-direction: column; }
    @media (min-width: 768px) { .md\:flex-row { flex-direction: row; } }
    .text-sm { font-size: 0.875rem; line-height: 1.25rem; }
    .text-xs { font-size: 0.75rem; line-height: 1rem; }
    .text-lg { font-size: 1.125rem; line-height: 1.75rem; }
    .text-4xl { font-size: 2.25rem; line-height: 2.5rem; }
    .md\:text-6xl { font-size: 2.25rem; line-height: 2.5rem; }
    @media (min-width: 768px) { .md\:text-6xl { font-size: 3.75rem; line-height: 1; } }
    .font-bold { font-weight: 700; }
    .font-extrabold { font-weight: 800; }
    .font-black { font-weight: 900; }
    .text-white { color: #fff; }
    .text-gray-300 { color: #d1d5db; }
    .text-neutral-400 { color: #9ca3af; }
    .text-emerald-400 { color: #22c55e; }
    .text-emerald-400\/80 { color: rgba(34, 197, 94, 0.8); }
    .bg-black\/50 { background-color: rgba(0, 0, 0, 0.5); }
    .bg-emerald-400\/20 { background-color: rgba(34, 197, 94, 0.2); }
    .bg-black\/40 { background-color: rgba(0, 0, 0, 0.4); }
    .border { border-width: 1px; }
    .border-white\/10 { border-color: rgba(255, 255, 255, 0.1); }
    .border-emerald-400\/40 { border-color: rgba(34, 197, 94, 0.4); }
    .rounded-xl { border-radius: 0.75rem; }
    .rounded-lg { border-radius: 0.5rem; }
    .w-full { width: 100%; }
    .w-8 { width: 2rem; }
    .h-8 { height: 2rem; }
    .w-32 { width: 8rem; }
    .grid-glow { position: relative; }
    .grid-glow:before { content:""; position:absolute; inset:-2px; background: radial-gradient(50% 50% at 50% 50%, rgba(34,197,94,0.20), rgba(34,197,94,0) 60%); filter: blur(30px); z-index:-1; }
    .scan { background: linear-gradient(90deg, rgba(0,0,0,0) 0%, rgba(34,197,94,0.25) 50%, rgba(0,0,0,0) 100%); animation: scan 3s linear infinite; }
    @keyframes scan { 0% { transform: translateX(-100%);} 100% { transform: translateX(100%);} }
    .matrix { background-image: linear-gradient(rgba(34,197,94,0.08) 1px, transparent 1px), linear-gradient(90deg, rgba(34,197,94,0.08) 1px, transparent 1px); background-size: 24px 24px, 24px 24px; }
    .btn { display:inline-flex; align-items:center; justify-content:center; gap:.5rem; padding:.9rem 1.15rem; border-radius:1rem; font-weight:700; transition:all .2s ease; }
    .btn-g { background:linear-gradient(to bottom right, #22c55e, #16a34a); color:#051b0d; }
    .btn-g:hover { filter:brightness(1.08); transform: translateY(-1px); }
    .btn-ghost { border:1px solid rgba(255,255,255,.12); }
    .card { background: rgba(255,255,255,0.03); border:1px solid rgba(255,255,255,0.08); border-radius:1.25rem; }
    .tag { border:1px solid rgba(255,255,255,0.16); border-radius:999px; padding:.25rem .6rem; font-size:.75rem; opacity:.9 }
    .clock { font-variant-numeric: tabular-nums; font-weight:700 }
    .tooltip { position: relative; }
    .tooltip:hover:after { content: 'This is a demo preview only'; position: absolute; bottom: -2rem; left: 50%; transform: translateX(-50%); background: #111; color: #d1fae5; padding: 0.5rem; border-radius: 0.5rem; font-size: 0.75rem; white-space: nowrap; z-index: 10; }
    .sticky { position: sticky; top: 0; }
    .z-40 { z-index: 40; }
    .backdrop-blur { backdrop-filter: blur(8px); }
    .place-items-center { place-items: center; }
    .leading-tight { line-height: 1.25; }
    .overflow-hidden { overflow: hidden; }
    .absolute { position: absolute; }
    .inset-0 { inset: 0; }
    .opacity-30 { opacity: 0.3; }
    .inset-y-0 { top: 0; bottom: 0; }
    .left-0 { left: 0; }
    .w-1\/3 { width: 33.333333%; }
    .p-5 { padding: 1.25rem; }
    .p-4 { padding: 1rem; }
    .mb-2 { margin-bottom: 0.5rem; }
    .-mt-1 { margin-top: -0.25rem; }
  </style>
</head>
<body>
  <!-- top bar -->
  <div class="w-full sticky top-0 z-40 backdrop-blur bg-black/50 border-b border-white/10">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="w-8 h-8 rounded-xl bg-emerald-400/20 border border-emerald-400/40 grid place-items-center"><span class="text-emerald-400 font-black">G</span></div>
        <div>
          <div class="text-sm text-white font-extrabold tracking-wide">GoblinReach</div>
          <div class="text-xs text-emerald-400/80 -mt-1">Spy‑clean DM automation</div>
        </div>
      </div>
      <div class="flex items-center gap-2 text-xs">
        <span class="tag">Rotating Proxies</span>
        <span class="tag">VPN‑Ready</span>
        <span class="tag">24/7 Cloud‑friendly</span>
      </div>
      <div class="flex items-center gap-3">
        <button id="awakeBtn" class="btn btn-ghost text-xs" type="button">Keep Awake</button>
        <div class="clock text-emerald-400" id="clock"></div>
        <div class="clock text-emerald-400" id="utcClock"></div>
        <div class="clock text-emerald-400" id="ptClock"></div>
      </div>
    </div>
  </div>

  <!-- hero -->
  <header class="matrix relative overflow-hidden">
    <div class="absolute inset-0 opacity-30">
      <div class="scan absolute inset-y-0 left-0 w-1/3"></div>
    </div>
    <div class="max-w-6xl mx-auto px-4 py-16 grid md:grid-cols-2 gap-10">
      <div class="grid-glow">
        <h1 class="text-4xl md:text-6xl font-black leading-tight">Let AI handle your Instagram DMs — <span class="text-emerald-400">safely</span>, on autopilot.</h1>
        <p class="mt-4 text-lg text-gray-300">Human‑like pacing (600s+ jitter), proxy support, and one‑minute setup. This page is a single file — paste to Vercel and sell now.</p>
        <div class="mt-6 flex flex-wrap gap-3">
          <a href="https://buy.stripe.com/cNi14mbtHajR98jdBuaZi03" class="btn btn-g">$22 / month — Start</a>
          <a href="https://buy.stripe.com/3cIbJ00P3gIfesD9leaZi04" class="btn btn-ghost">$95 / 6 months</a>
        </div>
        <div class="mt-2 text-xs text-neutral-400">After payment: click <strong>"I paid — give me access"</strong> below to unlock instant download.</div>
        <div class="mt-6 flex gap-4 text-sm text-neutral-400">
          <div>18–31 avg replies / 100 DMs</div>
          <div>600–900s safe delay</div>
          <div>1,000+ installs</div>
        </div>
      </div>
      <div>
        <div class="card p-5 tooltip">
          <div class="text-sm text-neutral-400 mb-2">LIVE preview (demo only)</div>
          <div class="rounded-xl border border-white/10 overflow-hidden">
            <div class="p-4 bg-black/40 flex items-center justify-between">
              <div class="text-xs text-neutral-400">Automation Status</div>
              <div class="text-xs text-emerald-400">Stable</div>
            </div>
            <div class="p-4 grid gap-4">
              <label class="text-sm">Audience Source</label>
              <select class="bg-black/40 border border-white/10 rounded-lg p-2 text-sm" disabled>
                <option>People who liked a post</option>
                <option>Commenters of a post</option>
                <option>A user's followers</option>
                <option>A user's following</option>
              </select>
              <label class="text-sm">Post/Username URL</label>
              <input class="bg-black/40 border border-white/10 rounded-lg p-2 text-sm" placeholder="https://instagram.com/p/POST_ID or @username" disabled />
              <label class="text-sm">Message Template</label>
              <textarea class="bg-black/40 border border-white/10 rounded-lg p-2 text-sm" rows="3" placeholder="Hey {{name}} — quick question about…" disabled></textarea>
              <label class="text-sm">Delay (sec, keep ≥600)</label>
              <input type="number" value="600" min="600" class="bg-black/40 border border-white/10 rounded-lg p-2 text-sm w-32" disabled />
              <button class="btn btn-g w-full" type="button" id="mockStart">Toggle Automation (demo)</button>
            </div>
          </div>
        </div>
        <div class="text-xs text-neutral-400 mt-2">Tip: keep ~600s between actions for best deliverability. Use proxies & VPN.</div>
      </div>
    </div>
  </header>

  <!-- access card -->
  <section class="max-w-6xl mx-auto px-4 mt-8 mb-16">
    <div class="card p-6">
      <div class="flex flex-col md:flex-row items-start md:items-center justify-between gap-4">
        <div>
          <div class="text-lg font-bold">Get Instant Access</div>
          <div class="text-sm text-neutral-400">Paid already? Unlock the starter extension immediately. No email wait. No ban‑bait.</div>
        </div>
        <div class="flex flex-wrap gap-2">
          <button class="btn btn-g" id="unlockBtn" type="button">I paid — give me access</button>
          <button class="btn btn-ghost" id="trialBtn" type="button">Free trial: 50 DMs (safe mode)</button>
        </div>
      </div>
    </div>
  </section>

  <!-- features -->
  <section class="max-w-6xl mx-auto px-4 grid md:grid-cols-3 gap-6 mb-16">
    <div class="card p-5">
      <div class="text-sm text-emerald-400 mb-1">Rotating Proxies</div>
      <div class="font-bold text-lg">Stay under the radar</div>
      <p class="text-sm text-neutral-400 mt-2">Rotate per action or per batch. Randomize delays with jitter. Obey 600–900s cadence.</p>
    </div>
    <div class="card p-5">
      <div class="text-sm text-emerald-400 mb-1">VPN + Cloud 24/7</div>
      <div class="font-bold text-lg">Run while your laptop is off</div>
      <p class="text-sm text-neutral-400 mt-2">Deploy the bot on a cheap VPS. Auto‑retry & resume after crashes. Persistent background service for 24/7 operation.</p>
    </div>
    <div class="card p-5">
      <div class="text-sm text-emerald-400 mb-1">Instant Delivery</div>
      <div class="font-bold text-lg">Download right after checkout</div>
      <p class="text-sm text-neutral-400 mt-2">Use the unlock button above. No email friction. Your download is local and fast.</p>
    </div>
  </section>

  <!-- JS libs to generate a ZIP on the fly -->
  <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>

  <script>
    // World clocks
    function updateClock() {
      try {
        const now = new Date();
        const etOpts = { timeZone: 'America/New_York', hour12: false, hour: '2-digit', minute: '2-digit', second: '2-digit' };
        document.getElementById('clock').textContent = new Intl.DateTimeFormat('en-US', etOpts).format(now) + ' ET';
        const utcOpts = { timeZone: 'UTC', hour12: false, hour: '2-digit', minute: '2-digit', second: '2-digit' };
        document.getElementById('utcClock').textContent = new Intl.DateTimeFormat('en-US', utcOpts).format(now) + ' UTC';
        const ptOpts = { timeZone: 'America/Los_Angeles', hour12: false, hour: '2-digit', minute: '2-digit', second: '2-digit' };
        document.getElementById('ptClock').textContent = new Intl.DateTimeFormat('en-US', ptOpts).format(now) + ' PT';
      } catch (e) {
        console.error('Clock update error:', e);
      }
    }
    setInterval(updateClock, 250);
    updateClock();

    // Keep Awake (uses Screen Wake Lock API)
    let wakeLock = null;
    let wakeOn = false;
    async function toggleWake() {
      try {
        if (!wakeOn) {
          wakeLock = await navigator.wakeLock.request('screen');
          wakeOn = true;
          document.getElementById('awakeBtn').textContent = 'Awake ON';
        } else {
          await wakeLock.release();
          wakeOn = false;
          document.getElementById('awakeBtn').textContent = 'Keep Awake';
        }
      } catch (e) {
        console.error('Wake Lock error:', e);
        alert('Wake Lock not available on this device/browser.');
      }
    }
    const awakeBtn = document.getElementById('awakeBtn');
    if (awakeBtn) {
      awakeBtn.addEventListener('click', toggleWake);
    }
    document.addEventListener('visibilitychange', async () => {
      if (document.visibilityState === 'visible' && wakeOn) {
        try {
          wakeLock = await navigator.wakeLock.request('screen');
        } catch (e) {
          console.error('Wake Lock re-request error:', e);
        }
      }
    });

    // Demo toggle button
    const mockStart = document.getElementById('mockStart');
    if (mockStart) {
      mockStart.addEventListener('click', function () {
        console.log('Toggle Automation (demo) clicked');
        this.textContent = this.textContent.includes('ON') ? 'Toggle Automation (demo)' : 'Automation ON (demo)';
      });
    }

    // Helper: create a Chrome MV3 extension zip
    async function buildExtensionZip({ trial = false } = {}) {
      try {
        console.log('Building ZIP for', trial ? 'trial' : 'full version');
        if (!window.JSZip || !window.saveAs) {
          throw new Error('Required libraries (JSZip or FileSaver) not loaded.');
        }
        const zip = new JSZip();

        const manifest = {
          manifest_version: 3,
          name: trial ? 'GoblinReach Trial (50 DMs)' : 'GoblinReach DM Automator',
          version: '0.1.0',
          description: 'Human-like Instagram DM pacing with delay controls and proxy tips.',
          action: { default_popup: 'popup.html' },
          background: { service_worker: 'background.js' },
          permissions: ['storage', 'activeTab', 'scripting', 'alarms'],
          host_permissions: ['https://*.instagram.com/*'],
          icons: {
            '16': 'icon16.png',
            '32': 'icon32.png',
            '128': 'icon128.png'
          }
        };

        const popupHtml = `
<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>GoblinReach</title>
  <style>
    body { font: 14px Inter, system-ui; background: #0b0b0b; color: #e5e7eb; margin: 0; padding: 16px; }
    button { background: #22c55e; border: 0; color: #052e16; padding: 10px 12px; border-radius: 12px; font-weight: 800; }
    input, textarea, select { width: 100%; background: #101010; border: 1px solid #2a2a2a; color: #cfcfcf; border-radius: 10px; padding: 8px; }
    #stop { background: #202020; color: #d1d5db; }
  </style>
</head>
<body>
  <h1 style="margin:0 0 8px;">GoblinReach ${trial ? 'Trial' : ''}</h1>
  <div style="opacity:.7;margin-bottom:10px">Keep delay ≥ 600s. Obey platform rules.</div>
  <label>Audience</label>
  <select id="aud">
    <option>People who liked a post</option>
    <option>Commenters of a post</option>
    <option>A user's followers</option>
    <option>A user's following</option>
  </select>
  <label style="margin-top:8px;display:block">Post/Username</label>
  <input id="target" placeholder="https://instagram.com/p/POST_ID or @user">
  <label style="margin-top:8px;display:block">Message</label>
  <textarea id="msg" rows="3" placeholder="Hey {{name}} — quick question…"></textarea>
  <label style="margin-top:8px;display:block">Delay (sec)</label>
  <input id="delay" type="number" min="600" value="600">
  <div style="display:flex;gap:8px;margin-top:12px">
    <button id="start">Start</button>
    <button id="stop">Stop</button>
  </div>
  <div id="log" style="margin-top:10px;opacity:.8;white-space:pre-wrap"></div>
  <script src="popup.js"></script>
</body>
</html>`;

        const popupJs = `
const log = (t) => { document.getElementById('log').textContent += t + "\\n"; };
async function saveSettings() {
  try {
    const aud = document.getElementById('aud').value;
    const target = document.getElementById('target').value.trim();
    const msg = document.getElementById('msg').value.trim();
    const delay = parseInt(document.getElementById('delay').value, 10) || 600;
    await chrome.storage.sync.set({ aud, target, msg, delay });
    return { aud, target, msg, delay };
  } catch (e) {
    console.error('Save settings error:', e);
    log('Error saving settings.');
  }
}
document.getElementById('start').onclick = async () => {
  try {
    const { delay } = await saveSettings();
    if (delay < 600) { alert('Keep delay ≥ 600 for safety.'); return; }
    log('Starting with delay ' + delay + 's');
    chrome.runtime.sendMessage({ action: 'start' });
  } catch (e) {
    console.error('Start error:', e);
    log('Error starting automation.');
  }
};
document.getElementById('stop').onclick = () => {
  try {
    log('Stopped.');
    chrome.runtime.sendMessage({ action: 'stop' });
  } catch (e) {
    console.error('Stop error:', e);
    log('Error stopping automation.');
  }
};
chrome.runtime.onMessage.addListener((msg, sender, sendResponse) => {
  if (msg.action === 'log') { log(msg.text); }
  sendResponse({});
});
`;

        const backgroundJs = `
let count = 0;
let limit = 0;
function keepAlive() {
  setInterval(chrome.runtime.getPlatformInfo, 20000);
}
keepAlive();
chrome.runtime.onMessage.addListener((message, sender, sendResponse) => {
  try {
    if (message.action === 'start') {
      chrome.storage.sync.get(['aud', 'target', 'msg', 'delay'], (st) => {
        limit = ${trial ? 50 : 999999};
        count = 0;
        if (st.target) {
          openTarget(st.target);
          createNextAlarm(st.delay || 600);
          chrome.runtime.sendMessage({ action: 'log', text: 'Automation started.' });
        } else {
          chrome.runtime.sendMessage({ action: 'log', text: 'Error: No target specified.' });
        }
      });
    } else if (message.action === 'stop') {
      chrome.alarms.clear('dmAlarm');
      chrome.runtime.sendMessage({ action: 'log', text: 'Automation stopped.' });
    }
    sendResponse({});
  } catch (e) {
    console.error('Background message error:', e);
    chrome.runtime.sendMessage({ action: 'log', text: 'Background error: ' + e.message });
    sendResponse({});
  }
});
async function openTarget(target) {
  try {
    if (!target) return;
    let url = target;
    if (target.startsWith('@')) { url = \`https://www.instagram.com/\${target.replace('@', '')}/\`; }
    if (!/^https?:\\/\\//.test(url)) return;
    chrome.tabs.query({ active: true, currentWindow: true }, (tabs) => {
      if (!tabs[0]) return;
      chrome.tabs.update(tabs[0].id, { url });
    });
  } catch (e) {
    console.error('Open target error:', e);
  }
}
function createNextAlarm(delay) {
  try {
    const when = Date.now() + (delay * 1000) + Math.floor(Math.random() * 60000);
    chrome.alarms.create('dmAlarm', { when });
  } catch (e) {
    console.error('Alarm creation error:', e);
  }
}
chrome.alarms.onAlarm.addListener((alarm) => {
  try {
    if (alarm.name === 'dmAlarm') {
      if (count >= limit) {
        chrome.runtime.sendMessage({ action: 'log', text: 'Limit reached.' });
        return;
      }
      count++;
      chrome.runtime.sendMessage({ action: 'log', text: \`Step \${count}: injecting assistant…\` });
      chrome.tabs.query({ active: true, currentWindow: true }, (tabs) => {
        if (tabs[0]) {
          chrome.scripting.executeScript({ target: { tabId: tabs[0].id }, files: ['worker.js'] });
        } else {
          chrome.runtime.sendMessage({ action: 'log', text: 'No active tab found.' });
        }
      });
      chrome.storage.sync.get(['delay'], (st) => { createNextAlarm(st.delay || 600); });
    }
  } catch (e) {
    console.error('Alarm error:', e);
    chrome.runtime.sendMessage({ action: 'log', text: 'Alarm error: ' + e.message });
  }
});
`;

        const workerJs = `
(async () => {
  try {
    const st = await new Promise(r => chrome.storage.sync.get(['msg'], r));
    let message = st.msg || 'Hey — quick question about your work!';
    const sleep = (ms) => new Promise(res => setTimeout(res, ms));
    const trySel = (sel) => new Promise(res => {
      let t = 0;
      const id = setInterval(() => {
        const el = document.querySelector(sel);
        if (el || t > 40) { clearInterval(id); res(el); }
        t++;
      }, 150);
    });

    // Personalize message with {{name}}
    const nameEl = document.querySelector('h1, h2, [data-testid="user-card-name"]') || document.querySelector('meta[property="og:title"]');
    const name = nameEl ? (nameEl.textContent || nameEl.content || '').trim().split(' ')[0] : '';
    message = message.replace('{{name}}', name);

    // If on a profile page, click Message button first
    const msgBtn = Array.from(document.querySelectorAll('button, div[role="button"]')).find(b => /message/i.test(b.textContent || b.ariaLabel || b.innerText || ''));
    if (msgBtn) {
      msgBtn.click();
      await sleep(1500);
    } else {
      console.log('[GoblinReach] No message button found.');
    }

    // Find a DM textbox (Instagram uses contenteditable or textarea)
    const box = await trySel('div[role="textbox"], textarea, div[contenteditable="true"]');
    if (!box) {
      console.log('[GoblinReach] No message box found. Open a profile page first.');
      chrome.runtime.sendMessage({ action: 'log', text: 'No message box found.' });
      return;
    }

    // Focus and insert text with events so IG detects it
    box.focus();
    const setVal = (el, value) => {
      const inputEvt = new InputEvent('input', { bubbles: true });
      if ('value' in el) { el.value = value; el.dispatchEvent(inputEvt); }
      else { el.textContent = value; el.dispatchEvent(inputEvt); }
    };
    setVal(box, message);

    // Auto-send
    await sleep(500);
    const sendBtn = document.querySelector('[aria-label="Send"], button[type="submit"], div[role="button"] > svg[aria-label="Send"]')?.closest('div[role="button"], button');
    if (sendBtn) {
      sendBtn.click();
    } else {
      box.dispatchEvent(new KeyboardEvent('keydown', { key: 'Enter', code: 'Enter', keyCode: 13, which: 13, bubbles: true, cancelable: true }));
    }

    // Log success
    chrome.runtime.sendMessage({ action: 'log', text: 'Message sent to ' + name });

    // Tip
    const tip = document.createElement('div');
    tip.textContent = 'Message sent by GoblinReach — automatic mode.';
    tip.style.cssText = 'position:fixed;right:12px;bottom:12px;background:#111;border:1px solid #2a2a2a;color:#d1fae5;padding:10px 12px;border-radius:10px;z-index:9999;font:12px Inter,system-ui;';
    document.body.appendChild(tip);
    setTimeout(() => tip.remove(), 6000);
  } catch (e) {
    console.error('Worker error:', e);
    chrome.runtime.sendMessage({ action: 'log', text: 'Error sending message: ' + e.message });
  }
})();
`;

        const readmeTxt = `
GoblinReach DM Automator Setup Guide

To run 24/7 on cloud:
1. Set up a VPS (e.g., DigitalOcean $6/month, AWS, or Linode with Ubuntu 20.04+).
2. Install Chromium: \`sudo apt update && sudo apt install chromium-browser\`.
3. Unzip the extension to a folder (e.g., /home/user/goblinreach).
4. Load the extension in Chrome:
   - Run: \`chromium-browser --load-extension=/path/to/unzipped --user-data-dir=/tmp/chrome-data\`.
   - Open chrome://extensions, enable Developer mode, and verify the extension is loaded.
5. Start automation:
   - Open the extension popup, configure audience, target, message, and delay (≥600s).
   - Click "Start" to begin automation.
6. For headless 24/7 operation:
   - Run: \`chromium-browser --headless=new --disable-gpu --remote-debugging-port=9222 --load-extension=/path/to/unzipped --user-data-dir=/tmp/chrome-data\`.
   - Use \`screen\` or \`tmux\` to detach: \`screen -S goblinreach chromium-browser [args above]\`.
   - Or set up a systemd service:
     \`\`\`
     [Unit]
     Description=GoblinReach DM Automator
     After=network.target
     [Service]
     ExecStart=/usr/bin/chromium-browser --headless=new --disable-gpu --remote-debugging-port=9222 --load-extension=/path/to/unzipped --user-data-dir=/tmp/chrome-data
     Restart=always
     User=youruser
     [Install]
     WantedBy=multi-user.target
     \`\`\`
     Save as \`/etc/systemd/system/goblinreach.service\`, then: \`sudo systemctl enable goblinreach && sudo systemctl start goblinreach\`.
7. Use proxies/VPN:
   - Configure a proxy (e.g., via \`--proxy-server=http://your-proxy:port\` in Chrome args).
   - Rotate IPs per action using a proxy service (e.g., Bright Data, Smartproxy).
   - Ensure VPN is active for additional safety.
8. Monitor logs:
   - Check chrome://extensions in Developer mode for errors.
   - View VPS logs: \`journalctl -u goblinreach\` (if using systemd).
   - Extension logs appear in the popup's log area.
9. Troubleshooting:
   - If automation stops, check Instagram's DOM changes (update selectors in worker.js).
   - Ensure delay ≥600s to avoid bans.
   - Test with trial mode (50 DMs) before full deployment.
Note: Instagram may detect automation. Use proxies, rotate IPs, and keep delays high. Obey platform rules.
`;

        const iconPng = atob('iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAACXBIWXMAAAsSAAALEgHS3X78AAABcElEQVR4nO2aUW7CMBCEZ2wq3s2w7x8J6Hq2iQnQy1xQw0m0k9m1mN1hZf7lqf7gGxk0cZP7mKp3xq1y9VbSg1l2x1C8vQm0l1mBqC0oZyqf8zj3w0xZK9v0bB3cH3YbX4o3+2M9o1QmG4QwI6Jw0g1+3m4eG2bDTv5f2F1mFh0c3j2sN4sQhF0pZ4KkqC2qS3qJv5vVwCjF1e8m7m0w1m2G1G6Qq0u9b1+qkO2t7+oG3Z8qH6L1gXfDqVb5H1Ck8A0j9q4lq3qQm2mYcK8C4X8hL8QG0h6m9y7y0g2pQq2E3qk6k2gD2o2Y0g9w3oEe2dB9wCqz6qFZy7mJYt2yYvP2w0bJ0Z1m3bZt0f3J7pQqQ1m9b4b1kP1Q6kqg9+2v1m3q2Q1m3hXf8j8iA6D2c4wJ5mOa1S6z1Fv3oY3GQqf2oQAAAAAElFTkSuQmCC');

        zip.file('manifest.json', JSON.stringify(manifest, null, 2));
        zip.file('popup.html', popupHtml);
        zip.file('popup.js', popupJs);
        zip.file('background.js', backgroundJs);
        zip.file('worker.js', workerJs);
        zip.file('README.txt', readmeTxt);
        zip.file('icon16.png', iconPng, { binary: true });
        zip.file('icon32.png', iconPng, { binary: true });
        zip.file('icon128.png', iconPng, { binary: true });

        const blob = await zip.generateAsync({ type: 'blob' });
        saveAs(blob, trial ? 'goblinreach_trial.zip' : 'goblinreach_extension.zip');
        console.log('ZIP generated successfully');
      } catch (e) {
        console.error('ZIP generation error:', e);
        alert('Error generating extension. Check your internet connection or try again.');
      }
    }

    // Unlock & Trial buttons
    const unlockBtn = document.getElementById('unlockBtn');
    const trialBtn = document.getElementById('trialBtn');
    if (unlockBtn) {
      unlockBtn.addEventListener('click', () => {
        console.log('Unlock button clicked');
        buildExtensionZip({ trial: false });
      });
    }
    if (trialBtn) {
      trialBtn.addEventListener('click', () => {
        console.log('Trial button clicked');
        buildExtensionZip({ trial: true });
      });
    }

    // If Stripe returns with ?paid=1 we auto-unlock
    const qs = new URLSearchParams(location.search);
    if (qs.get('paid') === '1') {
      console.log('Auto-unlocking due to Stripe ?paid=1');
      buildExtensionZip({ trial: false });
    }
  </script>
</body>
</html>
